{{ define "main" }}
<article class="posts-list">
    {{ $paginator := .Paginate (where .Site.RegularPages "Type" "posts") }}
    
    {{ range $paginator.Pages }}
    {{ $image := "" }}
    {{ if .Params.cover }}
        {{ with .Params.cover.image }}
            {{ $image = . }}
        {{ end }}
    {{ else if .Params.image }}
        {{ $image = .Params.image }}
    {{ else }}
        {{ $images := findRE "!\\[.*?\\]\\((.*?)\\)" .RawContent 1 }}
        {{ if ge (len $images) 1 }}
            {{ $image = index $images 0 | replaceRE "!\\[.*?\\]\\((.*?)\\)" "$1" | replaceRE "\n" "" | string }}
        {{ end }}
    {{ end }}
    
    <article class="post-entry{{ if $image }} with-thumbnail{{ end }}">
        {{ if $image }}
            <div class="entry-thumbnail">
                <img src="{{ $image }}" alt="{{ .Title }}">
            </div>
        {{ end }}
        <header class="entry-header">
            <h2>{{ .Title }}</h2>
        </header>
        <div class="entry-content">
            <p>{{ .Summary | plainify | htmlUnescape }}...</p>
        </div>
        <footer class="entry-footer">
            <span class="entry-info">
                {{ .Date.Format "2006-01-02" }}
                {{ if .Params.categories }}
                · {{ range .Params.categories }}
                <span class="category-link">{{ . }}</span>
                {{ end }}
                {{ end }}
            </span>
        </footer>
        <a class="entry-link" aria-label="{{ .Title }}" href="{{ .Permalink }}"></a>
    </article>
    {{ end }}

    {{ if gt $paginator.TotalPages 1 }}
    <footer class="page-footer">
        <nav class="pagination">
            {{ if $paginator.HasPrev }}
            <a class="prev" href="{{ $paginator.Prev.URL }}">이전</a>
            {{ end }}
            
            <span class="page-number">{{ $paginator.PageNumber }} / {{ $paginator.TotalPages }}</span>
            
            {{ if $paginator.HasNext }}
            <a class="next" href="{{ $paginator.Next.URL }}">다음</a>
            {{ end }}
        </nav>
    </footer>
    {{ end }}
</article>
{{ end }}